"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.gesturesChainToString = gesturesChainToString;
exports.default = exports.commands = exports.helpers = exports.extensions = void 0;

require("source-map-support/register");

var _appiumBaseDriver = require("appium-base-driver");

var _appiumSupport = require("appium-support");

var _appiumIosDriver = require("appium-ios-driver");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("../logger"));

let helpers = {},
    extensions = {},
    commands = {};
exports.commands = commands;
exports.extensions = extensions;
exports.helpers = helpers;
commands.moveTo = _appiumIosDriver.iosCommands.gesture.moveTo;

commands.mobileShake = async function mobileShake() {
  if (!this.isSimulator()) {
    throw new _appiumBaseDriver.errors.UnknownError('Shake is not supported on real devices');
  }

  await this.opts.device.shake();
};

commands.click = async function click(el) {
  if (!this.isWebContext()) {
    return await this.nativeClick(el);
  }

  el = _appiumSupport.util.unwrapElement(el);

  if ((await this.settings.getSettings()).nativeWebTap) {
    _logger.default.debug('Using native web tap');

    await this.nativeWebTap(el);
  } else {
    let atomsElement = this.useAtomsElement(el);
    return await this.executeAtom('click', [atomsElement]);
  }
};

function gesturesChainToString(gestures, keysToInclude = ['options']) {
  return gestures.map(item => {
    let otherKeys = _lodash.default.difference(_lodash.default.keys(item), ['action']);

    otherKeys = _lodash.default.isArray(keysToInclude) ? _lodash.default.intersection(otherKeys, keysToInclude) : otherKeys;

    if (otherKeys.length) {
      return `${item.action}` + `(${_lodash.default.map(otherKeys, x => x + '=' + (_lodash.default.isPlainObject(item[x]) ? JSON.stringify(item[x]) : item[x])).join(', ')})`;
    }

    return item.action;
  }).join('-');
}

commands.performActions = async function performActions(actions) {
  _logger.default.debug(`Received the following W3C actions: ${JSON.stringify(actions, null, '  ')}`);

  const preprocessedActions = actions.map(action => Object.assign({}, action, action.type === 'pointer' ? {
    parameters: {
      pointerType: 'touch'
    }
  } : {})).map(action => {
    const modifiedAction = _lodash.default.clone(action) || {};
    modifiedAction.actions = (action.actions || []).filter(innerAction => !(innerAction.type === 'pause' && innerAction.duration === 0));
    return modifiedAction;
  });

  _logger.default.debug(`Preprocessed actions: ${JSON.stringify(preprocessedActions, null, '  ')}`);

  return await this.proxyCommand('/actions', 'POST', {
    actions: preprocessedActions
  });
};

commands.performTouch = async function performTouch(gestures) {
  _logger.default.debug(`Received the following touch action: ${gesturesChainToString(gestures)}`);

  try {
    return await this.proxyCommand('/wda/touch/perform', 'POST', {
      actions: gestures
    });
  } catch (e) {
    if (!this.isWebContext()) {
      throw e;
    }

    _logger.default.errorAndThrow('The Touch API is aimed for usage in NATIVE context. ' + 'Consider using "execute" API with custom events trigger script ' + `to emulate touch events being in WEBVIEW context. Original error: ${e.message}`);
  }
};

commands.performMultiAction = async function performMultiAction(actions) {
  _logger.default.debug(`Received the following multi touch action:`);

  for (let i in actions) {
    _logger.default.debug(`    ${parseInt(i, 10) + 1}: ${_lodash.default.map(actions[i], 'action').join('-')}`);
  }

  try {
    return await this.proxyCommand('/wda/touch/multi/perform', 'POST', {
      actions
    });
  } catch (e) {
    if (!this.isWebContext()) {
      throw e;
    }

    _logger.default.errorAndThrow('The MultiTouch API is aimed for usage in NATIVE context. ' + 'Consider using "execute" API with custom events trigger script ' + `to emulate multitouch events being in WEBVIEW context. Original error: ${e.message}`);
  }
};

commands.nativeClick = async function nativeClick(el) {
  el = _appiumSupport.util.unwrapElement(el);
  let endpoint = `/element/${el}/click`;
  return await this.proxyCommand(endpoint, 'POST', {});
};

helpers.mobileScroll = async function mobileScroll(opts = {}, swipe = false) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  let params = {};

  if (opts.name && !swipe) {
    params.name = opts.name;
  } else if (opts.direction) {
    if (!['up', 'down', 'left', 'right'].includes(opts.direction.toLowerCase())) {
      let msg = 'Direction must be up, down, left or right';

      _logger.default.errorAndThrow(msg);
    }

    params.direction = opts.direction;
  } else if (opts.predicateString && !swipe) {
    params.predicateString = opts.predicateString;
  } else if (opts.toVisible && !swipe) {
    params.toVisible = opts.toVisible;
  } else {
    let msg = swipe ? 'Mobile swipe requires direction' : 'Mobile scroll supports the following strategies: name, direction, predicateString, and toVisible. Specify one of these';

    _logger.default.errorAndThrow(msg);
  }

  if (!swipe && opts.distance) {
    params.distance = opts.distance;
  }

  let element = _appiumSupport.util.unwrapElement(opts.element);

  let endpoint = `/wda/element/${element}/${swipe ? 'swipe' : 'scroll'}`;
  return await this.proxyCommand(endpoint, 'POST', params);
};

helpers.mobileSwipe = async function mobileSwipe(opts = {}) {
  return await this.mobileScroll(opts, true);
};

function parseFloatParameter(paramName, paramValue, methodName) {
  if (_lodash.default.isUndefined(paramValue)) {
    _logger.default.errorAndThrow(`"${paramName}" parameter is mandatory for "${methodName}" call`);
  }

  const result = parseFloat(paramValue);

  if (isNaN(result)) {
    _logger.default.errorAndThrow(`"${paramName}" parameter should be a valid number. "${paramValue}" is given instead`);
  }

  return result;
}

helpers.mobilePinch = async function mobilePinch(opts = {}) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  const params = {
    scale: parseFloatParameter('scale', opts.scale, 'pinch'),
    velocity: parseFloatParameter('velocity', opts.velocity, 'pinch')
  };

  const el = _appiumSupport.util.unwrapElement(opts.element);

  return await this.proxyCommand(`/wda/element/${el}/pinch`, 'POST', params);
};

helpers.mobileDoubleTap = async function mobileDoubleTap(opts = {}) {
  if (opts.element) {
    const el = _appiumSupport.util.unwrapElement(opts.element);

    return await this.proxyCommand(`/wda/element/${el}/doubleTap`, 'POST');
  }

  const params = {
    x: parseFloatParameter('x', opts.x, 'doubleTap'),
    y: parseFloatParameter('y', opts.y, 'doubleTap')
  };
  return await this.proxyCommand('/wda/doubleTap', 'POST', params);
};

helpers.mobileTwoFingerTap = async function mobileTwoFingerTap(opts = {}) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  const el = _appiumSupport.util.unwrapElement(opts.element);

  return await this.proxyCommand(`/wda/element/${el}/twoFingerTap`, 'POST');
};

helpers.mobileTouchAndHold = async function mobileTouchAndHold(opts = {}) {
  let params = {
    duration: parseFloatParameter('duration', opts.duration, 'touchAndHold')
  };

  if (opts.element) {
    const el = _appiumSupport.util.unwrapElement(opts.element);

    return await this.proxyCommand(`/wda/element/${el}/touchAndHold`, 'POST', params);
  }

  params.x = parseFloatParameter('x', opts.x, 'touchAndHold');
  params.y = parseFloatParameter('y', opts.y, 'touchAndHold');
  return await this.proxyCommand('/wda/touchAndHold', 'POST', params);
};

helpers.mobileTap = async function mobileTap(opts = {}) {
  const params = {
    x: parseFloatParameter('x', opts.x, 'tap'),
    y: parseFloatParameter('y', opts.y, 'tap')
  };
  const el = opts.element ? _appiumSupport.util.unwrapElement(opts.element) : '0';
  return await this.proxyCommand(`/wda/tap/${el}`, 'POST', params);
};

helpers.mobileDragFromToForDuration = async function mobileDragFromToForDuration(opts = {}) {
  const params = {
    duration: parseFloatParameter('duration', opts.duration, 'dragFromToForDuration'),
    fromX: parseFloatParameter('fromX', opts.fromX, 'dragFromToForDuration'),
    fromY: parseFloatParameter('fromY', opts.fromY, 'dragFromToForDuration'),
    toX: parseFloatParameter('toX', opts.toX, 'dragFromToForDuration'),
    toY: parseFloatParameter('toY', opts.toY, 'dragFromToForDuration')
  };

  if (opts.element) {
    const el = _appiumSupport.util.unwrapElement(opts.element);

    return await this.proxyCommand(`/wda/element/${el}/dragfromtoforduration`, 'POST', params);
  }

  return await this.proxyCommand('/wda/dragfromtoforduration', 'POST', params);
};

helpers.mobileSelectPickerWheelValue = async function mobileSelectPickerWheelValue(opts = {}) {
  if (!opts.element) {
    _logger.default.errorAndThrow('Element id is expected to be set for selectPickerWheelValue method');
  }

  if (!_lodash.default.isString(opts.order) || !['next', 'previous'].includes(opts.order.toLowerCase())) {
    _logger.default.errorAndThrow(`The mandatory 'order' parameter is expected to be equal either to 'next' or 'previous'. ` + `'${opts.order}' is given instead`);
  }

  const el = _appiumSupport.util.unwrapElement(opts.element);

  const params = {
    order: opts.order
  };

  if (opts.offset) {
    params.offset = parseFloatParameter('offset', opts.offset, 'selectPickerWheelValue');
  }

  return await this.proxyCommand(`/wda/pickerwheel/${el}/select`, 'POST', params);
};

helpers.getCoordinates = async function getCoordinates(gesture) {
  let el = gesture.options.element;
  let coordinates = {
    x: 0,
    y: 0,
    areOffsets: false
  };
  let optionX = null;

  if (gesture.options.x) {
    optionX = parseFloatParameter('x', gesture.options.x, 'getCoordinates');
  }

  let optionY = null;

  if (gesture.options.y) {
    optionY = parseFloatParameter('y', gesture.options.y, 'getCoordinates');
  }

  if (el) {
    let rect = await this.getElementRect(el);
    let pos = {
      x: rect.x,
      y: rect.y
    };
    let size = {
      w: rect.width,
      h: rect.height
    };
    let offsetX = 0;
    let offsetY = 0;

    if (optionX || optionY) {
      offsetX = optionX || 0;
      offsetY = optionY || 0;
    } else {
      offsetX = size.w / 2;
      offsetY = size.h / 2;
    }

    coordinates.x = pos.x + offsetX;
    coordinates.y = pos.y + offsetY;
  } else {
    coordinates.areOffsets = gesture.action === 'moveTo';
    coordinates.x = optionX || 0;
    coordinates.y = optionY || 0;
  }

  return coordinates;
};

helpers.applyMoveToOffset = function applyMoveToOffset(firstCoordinates, secondCoordinates) {
  if (secondCoordinates.areOffsets) {
    return {
      x: firstCoordinates.x + secondCoordinates.x,
      y: firstCoordinates.y + secondCoordinates.y
    };
  } else {
    return secondCoordinates;
  }
};

Object.assign(extensions, helpers, commands);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIl0sIm5hbWVzIjpbImhlbHBlcnMiLCJleHRlbnNpb25zIiwiY29tbWFuZHMiLCJtb3ZlVG8iLCJpb3NDb21tYW5kcyIsImdlc3R1cmUiLCJtb2JpbGVTaGFrZSIsImlzU2ltdWxhdG9yIiwiZXJyb3JzIiwiVW5rbm93bkVycm9yIiwib3B0cyIsImRldmljZSIsInNoYWtlIiwiY2xpY2siLCJlbCIsImlzV2ViQ29udGV4dCIsIm5hdGl2ZUNsaWNrIiwidXRpbCIsInVud3JhcEVsZW1lbnQiLCJzZXR0aW5ncyIsImdldFNldHRpbmdzIiwibmF0aXZlV2ViVGFwIiwibG9nIiwiZGVidWciLCJhdG9tc0VsZW1lbnQiLCJ1c2VBdG9tc0VsZW1lbnQiLCJleGVjdXRlQXRvbSIsImdlc3R1cmVzQ2hhaW5Ub1N0cmluZyIsImdlc3R1cmVzIiwia2V5c1RvSW5jbHVkZSIsIm1hcCIsIml0ZW0iLCJvdGhlcktleXMiLCJfIiwiZGlmZmVyZW5jZSIsImtleXMiLCJpc0FycmF5IiwiaW50ZXJzZWN0aW9uIiwibGVuZ3RoIiwiYWN0aW9uIiwieCIsImlzUGxhaW5PYmplY3QiLCJKU09OIiwic3RyaW5naWZ5Iiwiam9pbiIsInBlcmZvcm1BY3Rpb25zIiwiYWN0aW9ucyIsInByZXByb2Nlc3NlZEFjdGlvbnMiLCJPYmplY3QiLCJhc3NpZ24iLCJ0eXBlIiwicGFyYW1ldGVycyIsInBvaW50ZXJUeXBlIiwibW9kaWZpZWRBY3Rpb24iLCJjbG9uZSIsImZpbHRlciIsImlubmVyQWN0aW9uIiwiZHVyYXRpb24iLCJwcm94eUNvbW1hbmQiLCJwZXJmb3JtVG91Y2giLCJlIiwiZXJyb3JBbmRUaHJvdyIsIm1lc3NhZ2UiLCJwZXJmb3JtTXVsdGlBY3Rpb24iLCJpIiwicGFyc2VJbnQiLCJlbmRwb2ludCIsIm1vYmlsZVNjcm9sbCIsInN3aXBlIiwiZWxlbWVudCIsImZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cyIsInBhcmFtcyIsIm5hbWUiLCJkaXJlY3Rpb24iLCJpbmNsdWRlcyIsInRvTG93ZXJDYXNlIiwibXNnIiwicHJlZGljYXRlU3RyaW5nIiwidG9WaXNpYmxlIiwiZGlzdGFuY2UiLCJtb2JpbGVTd2lwZSIsInBhcnNlRmxvYXRQYXJhbWV0ZXIiLCJwYXJhbU5hbWUiLCJwYXJhbVZhbHVlIiwibWV0aG9kTmFtZSIsImlzVW5kZWZpbmVkIiwicmVzdWx0IiwicGFyc2VGbG9hdCIsImlzTmFOIiwibW9iaWxlUGluY2giLCJzY2FsZSIsInZlbG9jaXR5IiwibW9iaWxlRG91YmxlVGFwIiwieSIsIm1vYmlsZVR3b0ZpbmdlclRhcCIsIm1vYmlsZVRvdWNoQW5kSG9sZCIsIm1vYmlsZVRhcCIsIm1vYmlsZURyYWdGcm9tVG9Gb3JEdXJhdGlvbiIsImZyb21YIiwiZnJvbVkiLCJ0b1giLCJ0b1kiLCJtb2JpbGVTZWxlY3RQaWNrZXJXaGVlbFZhbHVlIiwiaXNTdHJpbmciLCJvcmRlciIsIm9mZnNldCIsImdldENvb3JkaW5hdGVzIiwib3B0aW9ucyIsImNvb3JkaW5hdGVzIiwiYXJlT2Zmc2V0cyIsIm9wdGlvblgiLCJvcHRpb25ZIiwicmVjdCIsImdldEVsZW1lbnRSZWN0IiwicG9zIiwic2l6ZSIsInciLCJ3aWR0aCIsImgiLCJoZWlnaHQiLCJvZmZzZXRYIiwib2Zmc2V0WSIsImFwcGx5TW92ZVRvT2Zmc2V0IiwiZmlyc3RDb29yZGluYXRlcyIsInNlY29uZENvb3JkaW5hdGVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxJQUFJQSxPQUFPLEdBQUcsRUFBZDtBQUFBLElBQWtCQyxVQUFVLEdBQUcsRUFBL0I7QUFBQSxJQUFtQ0MsUUFBUSxHQUFHLEVBQTlDOzs7O0FBRUFBLFFBQVEsQ0FBQ0MsTUFBVCxHQUFrQkMsNkJBQVlDLE9BQVosQ0FBb0JGLE1BQXRDOztBQUVBRCxRQUFRLENBQUNJLFdBQVQsR0FBdUIsZUFBZUEsV0FBZixHQUE4QjtBQUNuRCxNQUFJLENB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TyxJQUFJLENBQTVCO0FBQ0FGLElBQUFBLFdBQVcsQ0FBQ2YsQ0FBWixHQUFpQmtCLE9BQU8sSUFBSSxDQUE1QjtBQUNEOztBQUNELFNBQU9ILFdBQVA7QUFDRCxDQTVDRDs7QUE4Q0E1RyxPQUFPLENBQUMwSCxpQkFBUixHQUE0QixTQUFTQSxpQkFBVCxDQUE0QkMsZ0JBQTVCLEVBQThDQyxpQkFBOUMsRUFBaUU7QUFDM0YsTUFBSUEsaUJBQWlCLENBQUNmLFVBQXRCLEVBQWtDO0FBQ2hDLFdBQU87QUFDTHJFLE1BQUFBLENBQUMsRUFBRW1GLGdCQUFnQixDQUFDbkYsQ0FBakIsR0FBcUJvRixpQkFBaUIsQ0FBQ3BGLENBRHJDO0FBRUxxRCxNQUFBQSxDQUFDLEVBQUU4QixnQkFBZ0IsQ0FBQzlCLENBQWpCLEdBQXFCK0IsaUJBQWlCLENBQUMvQjtBQUZyQyxLQUFQO0FBSUQsR0FMRCxNQUtPO0FBQ0wsV0FBTytCLGlCQUFQO0FBQ0Q7QUFDRixDQVREOztBQVdBNUUsTUFBTSxDQUFDQyxNQUFQLENBQWNoRCxVQUFkLEVBQTBCRCxPQUExQixFQUFtQ0UsUUFBbkM7ZUFFZUQsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGVycm9ycyB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgeyB1dGlsIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgaW9zQ29tbWFuZHMgfSBmcm9tICdhcHBpdW0taW9zLWRyaXZlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGxvZyBmcm9tICcuLi9sb2dnZXInO1xuXG5cbmxldCBoZWxwZXJzID0ge30sIGV4dGVuc2lvbnMgPSB7fSwgY29tbWFuZHMgPSB7fTtcblxuY29tbWFuZHMubW92ZVRvID0gaW9zQ29tbWFuZHMuZ2VzdHVyZS5tb3ZlVG87XG5cbmNvbW1hbmRzLm1vYmlsZVNoYWtlID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlU2hha2UgKCkge1xuICBpZiAoIXRoaXMuaXNTaW11bGF0b3IoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkVycm9yKCdTaGFrZSBpcyBub3Qgc3VwcG9ydGVkIG9uIHJlYWwgZGV2aWNlcycpO1xuICB9XG4gIGF3YWl0IHRoaXMub3B0cy5kZXZpY2Uuc2hha2UoKTtcbn07XG5cbmNvbW1hbmRzLmNsaWNrID0gYXN5bmMgZnVuY3Rpb24gY2xpY2sgKGVsKSB7XG4gIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIC8vIHRoZXJlIGFyZSBtdWx0aXBsZSBjb21tYW5kcyB0aGF0IG1hcCBoZXJlLCBzbyBtYW51YWxseSBwcm94eVxuICAgIHJldHVybiBhd2FpdCB0aGlzLm5hdGl2ZUNsaWNrKGVsKTtcbiAgfVxuICBlbCA9IHV0aWwudW53cmFwRWxlbWVudChlbCk7XG4gIGlmICgoYXdhaXQgdGhpcy5zZXR0aW5ncy5nZXRTZXR0aW5ncygpKS5uYXRpdmVXZWJUYXApIHtcbiAgICAvLyBhdG9tcy1iYXNlZCBjbGlja3MgZG9uJ3QgYWx3YXlzIHdvcmsgaW4gc2FmYXJpIDdcbiAgICBsb2cuZGVidWcoJ1VzaW5nIG5hdGl2ZSB3ZWIgdGFwJyk7XG4gICAgYXdhaXQgdGhpcy5uYXRpdmVXZWJUYXAoZWwpO1xuICB9IGVsc2Uge1xuICAgIGxldCBhdG9tc0VsZW1lbnQgPSB0aGlzLnVzZUF0b21zRWxlbWVudChlbCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2NsaWNrJywgW2F0b21zRWxlbWVudF0pO1xuICB9XG59O1xuXG5mdW5jdGlvbiBnZXN0dXJlc0NoYWluVG9TdHJpbmcgKGdlc3R1cmVzLCBrZXlzVG9JbmNsdWRlID0gWydvcHRpb25zJ10pIHtcbiAgcmV0dXJuIGdlc3R1cmVzLm1hcCgoaXRlbSkgPT4ge1xuICAgIGxldCBvdGhlcktleXMgPSBfLmRpZmZlcmVuY2UoXy5rZXlzKGl0ZW0pLCBbJ2FjdGlvbiddKTtcbiAgICBvdGhlcktleXMgPSBfLmlzQXJyYXkoa2V5c1RvSW5jbHVkZSkgPyBfLmludGVyc2VjdGlvbihvdGhlcktleXMsIGtleXNUb0luY2x1ZGUpIDogb3RoZXJLZXlzO1xuICAgIGlmIChvdGhlcktleXMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gYCR7aXRlbS5hY3Rpb259YCArXG4gICAgICAgIGAoJHtfLm1hcChvdGhlcktleXMsICh4KSA9PiB4ICsgJz0nICsgKF8uaXNQbGFpbk9iamVjdChpdGVtW3hdKSA/IEpTT04uc3RyaW5naWZ5KGl0ZW1beF0pIDogaXRlbVt4XSkpLmpvaW4oJywgJyl9KWA7XG4gICAgfVxuICAgIHJldHVybiBpdGVtLmFjdGlvbjtcbiAgfSkuam9pbignLScpO1xufVxuXG5jb21tYW5kcy5wZXJmb3JtQWN0aW9ucyA9IGFzeW5jIGZ1bmN0aW9uIHBlcmZvcm1BY3Rpb25zIChhY3Rpb25zKSB7XG4gIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgdGhlIGZvbGxvd2luZyBXM0MgYWN0aW9uczogJHtKU09OLnN0cmluZ2lmeShhY3Rpb25zLCBudWxsLCAnICAnKX1gKTtcbiAgLy8gVGhpcyBpcyBtYW5kYXRvcnksIHNpbmNlIFdEQSBvbmx5IHN1cHBvcnRzIFRPVUNIIHBvaW50ZXIgdHlwZVxuICAvLyBhbmQgU2VsZW5pdW0gQVBJIHVzZXMgTU9VU0UgYXMgdGhlIGRlZmF1bHQgb25lXG4gIGNvbnN0IHByZXByb2Nlc3NlZEFjdGlvbnMgPSBhY3Rpb25zXG4gICAgLm1hcCgoYWN0aW9uKSA9PiBPYmplY3QuYXNzaWduKHt9LCBhY3Rpb24sIGFjdGlvbi50eXBlID09PSAncG9pbnRlcicgPyB7XG4gICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgIHBvaW50ZXJUeXBlOiAndG91Y2gnXG4gICAgICB9XG4gICAgfSA6IHt9KSlcbiAgICAubWFwKChhY3Rpb24pID0+IHtcbiAgICAgIGNvbnN0IG1vZGlmaWVkQWN0aW9uID0gXy5jbG9uZShhY3Rpb24pIHx8IHt9O1xuICAgICAgLy8gU2VsZW5pdW0gQVBJIHVuZXhwZWN0ZWRseSBpbnNlcnRzIHplcm8gcGF1c2VzLCB3aGljaCBhcmUgbm90IHN1cHBvcnRlZCBieSBXREFcbiAgICAgIG1vZGlmaWVkQWN0aW9uLmFjdGlvbnMgPSAoYWN0aW9uLmFjdGlvbnMgfHwgW10pXG4gICAgICAgIC5maWx0ZXIoKGlubmVyQWN0aW9uKSA9PiAhKGlubmVyQWN0aW9uLnR5cGUgPT09ICdwYXVzZScgJiYgaW5uZXJBY3Rpb24uZHVyYXRpb24gPT09IDApKTtcbiAgICAgIHJldHVybiBtb2RpZmllZEFjdGlvbjtcbiAgICB9KTtcbiAgbG9nLmRlYnVnKGBQcmVwcm9jZXNzZWQgYWN0aW9uczogJHtKU09OLnN0cmluZ2lmeShwcmVwcm9jZXNzZWRBY3Rpb25zLCBudWxsLCAnICAnKX1gKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvYWN0aW9ucycsICdQT1NUJywge2FjdGlvbnM6IHByZXByb2Nlc3NlZEFjdGlvbnN9KTtcbn07XG5cbmNvbW1hbmRzLnBlcmZvcm1Ub3VjaCA9IGFzeW5jIGZ1bmN0aW9uIHBlcmZvcm1Ub3VjaCAoZ2VzdHVyZXMpIHtcbiAgbG9nLmRlYnVnKGBSZWNlaXZlZCB0aGUgZm9sbG93aW5nIHRvdWNoIGFjdGlvbjogJHtnZXN0dXJlc0NoYWluVG9TdHJpbmcoZ2VzdHVyZXMpfWApO1xuICB0cnkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZCgnL3dkYS90b3VjaC9wZXJmb3JtJywgJ1BPU1QnLCB7YWN0aW9uczogZ2VzdHVyZXN9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgICAgdGhyb3cgZTtcbiAgICB9XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ1RoZSBUb3VjaCBBUEkgaXMgYWltZWQgZm9yIHVzYWdlIGluIE5BVElWRSBjb250ZXh0LiAnICtcbiAgICAgICdDb25zaWRlciB1c2luZyBcImV4ZWN1dGVcIiBBUEkgd2l0aCBjdXN0b20gZXZlbnRzIHRyaWdnZXIgc2NyaXB0ICcgK1xuICAgICAgYHRvIGVtdWxhdGUgdG91Y2ggZXZlbnRzIGJlaW5nIGluIFdFQlZJRVcgY29udGV4dC4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG5jb21tYW5kcy5wZXJmb3JtTXVsdGlBY3Rpb24gPSBhc3luYyBmdW5jdGlvbiBwZXJmb3JtTXVsdGlBY3Rpb24gKGFjdGlvbnMpIHtcbiAgbG9nLmRlYnVnKGBSZWNlaXZlZCB0aGUgZm9sbG93aW5nIG11bHRpIHRvdWNoIGFjdGlvbjpgKTtcbiAgZm9yIChsZXQgaSBpbiBhY3Rpb25zKSB7XG4gICAgbG9nLmRlYnVnKGAgICAgJHtwYXJzZUludChpLCAxMCkgKyAxfTogJHtfLm1hcChhY3Rpb25zW2ldLCAnYWN0aW9uJykuam9pbignLScpfWApO1xuICB9XG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL3RvdWNoL211bHRpL3BlcmZvcm0nLCAnUE9TVCcsIHthY3Rpb25zfSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICAgIHRocm93IGU7XG4gICAgfVxuICAgIGxvZy5lcnJvckFuZFRocm93KCdUaGUgTXVsdGlUb3VjaCBBUEkgaXMgYWltZWQgZm9yIHVzYWdlIGluIE5BVElWRSBjb250ZXh0LiAnICtcbiAgICAgICdDb25zaWRlciB1c2luZyBcImV4ZWN1dGVcIiBBUEkgd2l0aCBjdXN0b20gZXZlbnRzIHRyaWdnZXIgc2NyaXB0ICcgK1xuICAgICAgYHRvIGVtdWxhdGUgbXVsdGl0b3VjaCBldmVudHMgYmVpbmcgaW4gV0VCVklFVyBjb250ZXh0LiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLm5hdGl2ZUNsaWNrID0gYXN5bmMgZnVuY3Rpb24gbmF0aXZlQ2xpY2sgKGVsKSB7XG4gIGVsID0gdXRpbC51bndyYXBFbGVtZW50KGVsKTtcbiAgbGV0IGVuZHBvaW50ID0gYC9lbGVtZW50LyR7ZWx9L2NsaWNrYDtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGVuZHBvaW50LCAnUE9TVCcsIHt9KTtcbn07XG5cbi8qXG4gKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL1dlYkRyaXZlckFnZW50L2Jsb2IvbWFzdGVyL1dlYkRyaXZlckFnZW50TGliL0NvbW1hbmRzL0ZCRWxlbWVudENvbW1hbmRzLm1cbiAqIHRvIGdldCB0aGUgaW5mbyBhYm91dCBhdmFpbGFibGUgV0RBIGdlc3R1cmVzIEFQSVxuICpcbiAqIFNlZSBodHRwczovL2RldmVsb3Blci5hcHBsZS5jb20vcmVmZXJlbmNlL3hjdGVzdC94Y3VpZWxlbWVudCBhbmRcbiAqIGh0dHBzOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9yZWZlcmVuY2UveGN0ZXN0L3hjdWljb29yZGluYXRlIHRvIGdldCB0aGUgZGV0YWlsZWQgZGVzY3JpcHRpb24gb2ZcbiAqIGFsbCBYQ1Rlc3QgZ2VzdHVyZXNcbiovXG5cbmhlbHBlcnMubW9iaWxlU2Nyb2xsID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlU2Nyb2xsIChvcHRzID0ge30sIHN3aXBlID0gZmFsc2UpIHtcbiAgaWYgKCFvcHRzLmVsZW1lbnQpIHtcbiAgICBvcHRzLmVsZW1lbnQgPSBhd2FpdCB0aGlzLmZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cyhgY2xhc3MgbmFtZWAsIGBYQ1VJRWxlbWVudFR5cGVBcHBsaWNhdGlvbmAsIGZhbHNlKTtcbiAgfVxuICAvLyBXREEgc3VwcG9ydHMgZm91ciBzY3JvbGxpbmcgc3RyYXRlZ2llczogcHJlZGljYXRpb24gYmFzZWQgb24gbmFtZSwgZGlyZWN0aW9uLFxuICAvLyBwcmVkaWNhdGVTdHJpbmcsIGFuZCB0b1Zpc2libGUsIGluIHRoYXQgb3JkZXIuIFN3aXBpbmcgcmVxdWlyZXMgZGlyZWN0aW9uLlxuICBsZXQgcGFyYW1zID0ge307XG4gIGlmIChvcHRzLm5hbWUgJiYgIXN3aXBlKSB7XG4gICAgcGFyYW1zLm5hbWUgPSBvcHRzLm5hbWU7XG4gIH0gZWxzZSBpZiAob3B0cy5kaXJlY3Rpb24pIHtcbiAgICBpZiAoIVsndXAnLCAnZG93bicsICdsZWZ0JywgJ3JpZ2h0J10uaW5jbHVkZXMob3B0cy5kaXJlY3Rpb24udG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgIGxldCBtc2cgPSAnRGlyZWN0aW9uIG11c3QgYmUgdXAsIGRvd24sIGxlZnQgb3IgcmlnaHQnO1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3cobXNnKTtcbiAgICB9XG4gICAgcGFyYW1zLmRpcmVjdGlvbiA9IG9wdHMuZGlyZWN0aW9uO1xuICB9IGVsc2UgaWYgKG9wdHMucHJlZGljYXRlU3RyaW5nICYmICFzd2lwZSkge1xuICAgIHBhcmFtcy5wcmVkaWNhdGVTdHJpbmcgPSBvcHRzLnByZWRpY2F0ZVN0cmluZztcbiAgfSBlbHNlIGlmIChvcHRzLnRvVmlzaWJsZSAmJiAhc3dpcGUpIHtcbiAgICBwYXJhbXMudG9WaXNpYmxlID0gb3B0cy50b1Zpc2libGU7XG4gIH0gZWxzZSB7XG4gICAgbGV0IG1zZyA9IHN3aXBlXG4gICAgICA/ICdNb2JpbGUgc3dpcGUgcmVxdWlyZXMgZGlyZWN0aW9uJ1xuICAgICAgOiAnTW9iaWxlIHNjcm9sbCBzdXBwb3J0cyB0aGUgZm9sbG93aW5nIHN0cmF0ZWdpZXM6IG5hbWUsIGRpcmVjdGlvbiwgcHJlZGljYXRlU3RyaW5nLCBhbmQgdG9WaXNpYmxlLiBTcGVjaWZ5IG9uZSBvZiB0aGVzZSc7XG4gICAgbG9nLmVycm9yQW5kVGhyb3cobXNnKTtcbiAgfVxuXG4gIC8vIHdlIGNhbiBhbHNvIG9wdGlvbmFsbHkgcGFzcyBhIGRpc3RhbmNlIHdoaWNoIGFwcGVhcnMgdG8gYmUgYSByYXRpbyBvZlxuICAvLyBzY3JlZW4gaGVpZ2h0LCBzbyAxLjAgbWVhbnMgYSBmdWxsIHNjcmVlbidzIHdvcnRoIG9mIHNjcm9sbGluZ1xuICBpZiAoIXN3aXBlICYmIG9wdHMuZGlzdGFuY2UpIHtcbiAgICBwYXJhbXMuZGlzdGFuY2UgPSBvcHRzLmRpc3RhbmNlO1xuICB9XG5cbiAgbGV0IGVsZW1lbnQgPSB1dGlsLnVud3JhcEVsZW1lbnQob3B0cy5lbGVtZW50KTtcbiAgbGV0IGVuZHBvaW50ID0gYC93ZGEvZWxlbWVudC8ke2VsZW1lbnR9LyR7c3dpcGUgPyAnc3dpcGUnIDogJ3Njcm9sbCd9YDtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGVuZHBvaW50LCAnUE9TVCcsIHBhcmFtcyk7XG59O1xuXG5oZWxwZXJzLm1vYmlsZVN3aXBlID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlU3dpcGUgKG9wdHMgPSB7fSkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5tb2JpbGVTY3JvbGwob3B0cywgdHJ1ZSk7XG59O1xuXG5mdW5jdGlvbiBwYXJzZUZsb2F0UGFyYW1ldGVyIChwYXJhbU5hbWUsIHBhcmFtVmFsdWUsIG1ldGhvZE5hbWUpIHtcbiAgaWYgKF8uaXNVbmRlZmluZWQocGFyYW1WYWx1ZSkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgXCIke3BhcmFtTmFtZX1cIiBwYXJhbWV0ZXIgaXMgbWFuZGF0b3J5IGZvciBcIiR7bWV0aG9kTmFtZX1cIiBjYWxsYCk7XG4gIH1cbiAgY29uc3QgcmVzdWx0ID0gcGFyc2VGbG9hdChwYXJhbVZhbHVlKTtcbiAgaWYgKGlzTmFOKHJlc3VsdCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgXCIke3BhcmFtTmFtZX1cIiBwYXJhbWV0ZXIgc2hvdWxkIGJlIGEgdmFsaWQgbnVtYmVyLiBcIiR7cGFyYW1WYWx1ZX1cIiBpcyBnaXZlbiBpbnN0ZWFkYCk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuaGVscGVycy5tb2JpbGVQaW5jaCA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVBpbmNoIChvcHRzID0ge30pIHtcbiAgaWYgKCFvcHRzLmVsZW1lbnQpIHtcbiAgICBvcHRzLmVsZW1lbnQgPSBhd2FpdCB0aGlzLmZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cyhgY2xhc3MgbmFtZWAsIGBYQ1VJRWxlbWVudFR5cGVBcHBsaWNhdGlvbmAsIGZhbHNlKTtcbiAgfVxuICBjb25zdCBwYXJhbXMgPSB7XG4gICAgc2NhbGU6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3NjYWxlJywgb3B0cy5zY2FsZSwgJ3BpbmNoJyksXG4gICAgdmVsb2NpdHk6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3ZlbG9jaXR5Jywgb3B0cy52ZWxvY2l0eSwgJ3BpbmNoJylcbiAgfTtcbiAgY29uc3QgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQob3B0cy5lbGVtZW50KTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL2VsZW1lbnQvJHtlbH0vcGluY2hgLCAnUE9TVCcsIHBhcmFtcyk7XG59O1xuXG5oZWxwZXJzLm1vYmlsZURvdWJsZVRhcCA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZURvdWJsZVRhcCAob3B0cyA9IHt9KSB7XG4gIGlmIChvcHRzLmVsZW1lbnQpIHtcbiAgICAvLyBEb3VibGUgdGFwIGVsZW1lbnRcbiAgICBjb25zdCBlbCA9IHV0aWwudW53cmFwRWxlbWVudChvcHRzLmVsZW1lbnQpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL3dkYS9lbGVtZW50LyR7ZWx9L2RvdWJsZVRhcGAsICdQT1NUJyk7XG4gIH1cbiAgLy8gRG91YmxlIHRhcCBjb29yZGluYXRlc1xuICBjb25zdCBwYXJhbXMgPSB7XG4gICAgeDogcGFyc2VGbG9hdFBhcmFtZXRlcigneCcsIG9wdHMueCwgJ2RvdWJsZVRhcCcpLFxuICAgIHk6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3knLCBvcHRzLnksICdkb3VibGVUYXAnKVxuICB9O1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy93ZGEvZG91YmxlVGFwJywgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVUd29GaW5nZXJUYXAgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVUd29GaW5nZXJUYXAgKG9wdHMgPSB7fSkge1xuICBpZiAoIW9wdHMuZWxlbWVudCkge1xuICAgIG9wdHMuZWxlbWVudCA9IGF3YWl0IHRoaXMuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKGBjbGFzcyBuYW1lYCwgYFhDVUlFbGVtZW50VHlwZUFwcGxpY2F0aW9uYCwgZmFsc2UpO1xuICB9XG4gIGNvbnN0IGVsID0gdXRpbC51bndyYXBFbGVtZW50KG9wdHMuZWxlbWVudCk7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL3dkYS9lbGVtZW50LyR7ZWx9L3R3b0ZpbmdlclRhcGAsICdQT1NUJyk7XG59O1xuXG5oZWxwZXJzLm1vYmlsZVRvdWNoQW5kSG9sZCA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVRvdWNoQW5kSG9sZCAob3B0cyA9IHt9KSB7XG4gIGxldCBwYXJhbXMgPSB7XG4gICAgZHVyYXRpb246IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ2R1cmF0aW9uJywgb3B0cy5kdXJhdGlvbiwgJ3RvdWNoQW5kSG9sZCcpXG4gIH07XG4gIGlmIChvcHRzLmVsZW1lbnQpIHtcbiAgICAvLyBMb25nIHRhcCBlbGVtZW50XG4gICAgY29uc3QgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQob3B0cy5lbGVtZW50KTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvZWxlbWVudC8ke2VsfS90b3VjaEFuZEhvbGRgLCAnUE9TVCcsIHBhcmFtcyk7XG4gIH1cbiAgLy8gTG9uZyB0YXAgY29vcmRpbmF0ZXNcbiAgcGFyYW1zLnggPSBwYXJzZUZsb2F0UGFyYW1ldGVyKCd4Jywgb3B0cy54LCAndG91Y2hBbmRIb2xkJyk7XG4gIHBhcmFtcy55ID0gcGFyc2VGbG9hdFBhcmFtZXRlcigneScsIG9wdHMueSwgJ3RvdWNoQW5kSG9sZCcpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy93ZGEvdG91Y2hBbmRIb2xkJywgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVUYXAgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVUYXAgKG9wdHMgPSB7fSkge1xuICBjb25zdCBwYXJhbXMgPSB7XG4gICAgeDogcGFyc2VGbG9hdFBhcmFtZXRlcigneCcsIG9wdHMueCwgJ3RhcCcpLFxuICAgIHk6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3knLCBvcHRzLnksICd0YXAnKVxuICB9O1xuICBjb25zdCBlbCA9IG9wdHMuZWxlbWVudCA/ICh1dGlsLnVud3JhcEVsZW1lbnQob3B0cy5lbGVtZW50KSkgOiAnMCc7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL3dkYS90YXAvJHtlbH1gLCAnUE9TVCcsIHBhcmFtcyk7XG59O1xuXG5oZWxwZXJzLm1vYmlsZURyYWdGcm9tVG9Gb3JEdXJhdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZURyYWdGcm9tVG9Gb3JEdXJhdGlvbiAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHBhcmFtcyA9IHtcbiAgICBkdXJhdGlvbjogcGFyc2VGbG9hdFBhcmFtZXRlcignZHVyYXRpb24nLCBvcHRzLmR1cmF0aW9uLCAnZHJhZ0Zyb21Ub0ZvckR1cmF0aW9uJyksXG4gICAgZnJvbVg6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ2Zyb21YJywgb3B0cy5mcm9tWCwgJ2RyYWdGcm9tVG9Gb3JEdXJhdGlvbicpLFxuICAgIGZyb21ZOiBwYXJzZUZsb2F0UGFyYW1ldGVyKCdmcm9tWScsIG9wdHMuZnJvbVksICdkcmFnRnJvbVRvRm9yRHVyYXRpb24nKSxcbiAgICB0b1g6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3RvWCcsIG9wdHMudG9YLCAnZHJhZ0Zyb21Ub0ZvckR1cmF0aW9uJyksXG4gICAgdG9ZOiBwYXJzZUZsb2F0UGFyYW1ldGVyKCd0b1knLCBvcHRzLnRvWSwgJ2RyYWdGcm9tVG9Gb3JEdXJhdGlvbicpXG4gIH07XG4gIGlmIChvcHRzLmVsZW1lbnQpIHtcbiAgICAvLyBEcmFnIGVsZW1lbnRcbiAgICBjb25zdCBlbCA9IHV0aWwudW53cmFwRWxlbWVudChvcHRzLmVsZW1lbnQpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL3dkYS9lbGVtZW50LyR7ZWx9L2RyYWdmcm9tdG9mb3JkdXJhdGlvbmAsICdQT1NUJywgcGFyYW1zKTtcbiAgfVxuICAvLyBEcmFnIGNvb3JkaW5hdGVzXG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZCgnL3dkYS9kcmFnZnJvbXRvZm9yZHVyYXRpb24nLCAnUE9TVCcsIHBhcmFtcyk7XG59O1xuXG5oZWxwZXJzLm1vYmlsZVNlbGVjdFBpY2tlcldoZWVsVmFsdWUgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVTZWxlY3RQaWNrZXJXaGVlbFZhbHVlIChvcHRzID0ge30pIHtcbiAgaWYgKCFvcHRzLmVsZW1lbnQpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnRWxlbWVudCBpZCBpcyBleHBlY3RlZCB0byBiZSBzZXQgZm9yIHNlbGVjdFBpY2tlcldoZWVsVmFsdWUgbWV0aG9kJyk7XG4gIH1cbiAgaWYgKCFfLmlzU3RyaW5nKG9wdHMub3JkZXIpIHx8ICFbJ25leHQnLCAncHJldmlvdXMnXS5pbmNsdWRlcyhvcHRzLm9yZGVyLnRvTG93ZXJDYXNlKCkpKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYFRoZSBtYW5kYXRvcnkgJ29yZGVyJyBwYXJhbWV0ZXIgaXMgZXhwZWN0ZWQgdG8gYmUgZXF1YWwgZWl0aGVyIHRvICduZXh0JyBvciAncHJldmlvdXMnLiBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgJyR7b3B0cy5vcmRlcn0nIGlzIGdpdmVuIGluc3RlYWRgKTtcbiAgfVxuICBjb25zdCBlbCA9IHV0aWwudW53cmFwRWxlbWVudChvcHRzLmVsZW1lbnQpO1xuICBjb25zdCBwYXJhbXMgPSB7b3JkZXI6IG9wdHMub3JkZXJ9O1xuICBpZiAob3B0cy5vZmZzZXQpIHtcbiAgICBwYXJhbXMub2Zmc2V0ID0gcGFyc2VGbG9hdFBhcmFtZXRlcignb2Zmc2V0Jywgb3B0cy5vZmZzZXQsICdzZWxlY3RQaWNrZXJXaGVlbFZhbHVlJyk7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL3BpY2tlcndoZWVsLyR7ZWx9L3NlbGVjdGAsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMuZ2V0Q29vcmRpbmF0ZXMgPSBhc3luYyBmdW5jdGlvbiBnZXRDb29yZGluYXRlcyAoZ2VzdHVyZSkge1xuICBsZXQgZWwgPSBnZXN0dXJlLm9wdGlvbnMuZWxlbWVudDtcblxuICAvLyBkZWZhdWx0c1xuICBsZXQgY29vcmRpbmF0ZXMgPSB7eDogMCwgeTogMCwgYXJlT2Zmc2V0czogZmFsc2V9O1xuXG4gIGxldCBvcHRpb25YID0gbnVsbDtcbiAgaWYgKGdlc3R1cmUub3B0aW9ucy54KSB7XG4gICAgb3B0aW9uWCA9IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3gnLCBnZXN0dXJlLm9wdGlvbnMueCwgJ2dldENvb3JkaW5hdGVzJyk7XG4gIH1cbiAgbGV0IG9wdGlvblkgPSBudWxsO1xuICBpZiAoZ2VzdHVyZS5vcHRpb25zLnkpIHtcbiAgICBvcHRpb25ZID0gcGFyc2VGbG9hdFBhcmFtZXRlcigneScsIGdlc3R1cmUub3B0aW9ucy55LCAnZ2V0Q29vcmRpbmF0ZXMnKTtcbiAgfVxuXG4gIC8vIGZpZ3VyZSBvdXQgdGhlIGVsZW1lbnQgY29vcmRpbmF0ZXMuXG4gIGlmIChlbCkge1xuICAgIGxldCByZWN0ID0gYXdhaXQgdGhpcy5nZXRFbGVtZW50UmVjdChlbCk7XG4gICAgbGV0IHBvcyA9IHt4OiByZWN0LngsIHk6IHJlY3QueX07XG4gICAgbGV0IHNpemUgPSB7dzogcmVjdC53aWR0aCwgaDogcmVjdC5oZWlnaHR9O1xuXG4gICAgLy8gZGVmYXVsdHNcbiAgICBsZXQgb2Zmc2V0WCA9IDA7XG4gICAgbGV0IG9mZnNldFkgPSAwO1xuXG4gICAgLy8gZ2V0IHRoZSByZWFsIG9mZnNldHNcbiAgICBpZiAob3B0aW9uWCB8fCBvcHRpb25ZKSB7XG4gICAgICBvZmZzZXRYID0gKG9wdGlvblggfHwgMCk7XG4gICAgICBvZmZzZXRZID0gKG9wdGlvblkgfHwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9mZnNldFggPSAoc2l6ZS53IC8gMik7XG4gICAgICBvZmZzZXRZID0gKHNpemUuaCAvIDIpO1xuICAgIH1cblxuICAgIC8vIGFwcGx5IHRoZSBvZmZzZXRzXG4gICAgY29vcmRpbmF0ZXMueCA9IHBvcy54ICsgb2Zmc2V0WDtcbiAgICBjb29yZGluYXRlcy55ID0gcG9zLnkgKyBvZmZzZXRZO1xuICB9IGVsc2Uge1xuICAgIC8vIG1vdmVUbyBjb29yZGluYXRlcyBhcmUgcGFzc2VkIGluIGFzIG9mZnNldHNcbiAgICBjb29yZGluYXRlcy5hcmVPZmZzZXRzID0gKGdlc3R1cmUuYWN0aW9uID09PSAnbW92ZVRvJyk7XG4gICAgY29vcmRpbmF0ZXMueCA9IChvcHRpb25YIHx8IDApO1xuICAgIGNvb3JkaW5hdGVzLnkgPSAob3B0aW9uWSB8fCAwKTtcbiAgfVxuICByZXR1cm4gY29vcmRpbmF0ZXM7XG59O1xuXG5oZWxwZXJzLmFwcGx5TW92ZVRvT2Zmc2V0ID0gZnVuY3Rpb24gYXBwbHlNb3ZlVG9PZmZzZXQgKGZpcnN0Q29vcmRpbmF0ZXMsIHNlY29uZENvb3JkaW5hdGVzKSB7XG4gIGlmIChzZWNvbmRDb29yZGluYXRlcy5hcmVPZmZzZXRzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHg6IGZpcnN0Q29vcmRpbmF0ZXMueCArIHNlY29uZENvb3JkaW5hdGVzLngsXG4gICAgICB5OiBmaXJzdENvb3JkaW5hdGVzLnkgKyBzZWNvbmRDb29yZGluYXRlcy55LFxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHNlY29uZENvb3JkaW5hdGVzO1xuICB9XG59O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGhlbHBlcnMsIGNvbW1hbmRzKTtcbmV4cG9ydCB7IGV4dGVuc2lvbnMsIGhlbHBlcnMsIGNvbW1hbmRzLCBnZXN0dXJlc0NoYWluVG9TdHJpbmcgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
